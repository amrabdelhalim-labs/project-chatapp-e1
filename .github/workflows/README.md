# CI/CD โ Build & Deploy

## ููู ูุนูู ุงูู Workflow

ูุนูู ุชููุงุฆูุงู ุนูุฏ ูู `push` ุฅูู `main`ุ ุฃู ูุฏููุงู ุนุจุฑ **Actions โ Run workflow**.

### ุงููุธุงุฆู (Jobs)

| Job | ูุง ููุนู |
|-----|---------|
| **Deploy Server** | ุชุซุจูุช ุงูุชุจุนูุงุช โ ุชุดุบูู 232 ุงุฎุชุจุงุฑ (MongoDB service) โ ูุดุฑ ุฅูู ูุฑุน `server` |
| **Deploy Web** | ุชุซุจูุช ุงูุชุจุนูุงุช โ ุชุดุบูู 99 ุงุฎุชุจุงุฑ โ ุจูุงุก React โ ูุดุฑ ุฅูู ูุฑุน `web` |

ุงููุธููุชุงู ุชุนููุงู **ุจุงูุชูุงุฒู** โ ูุง ุชุนุชูุฏ ุฅุญุฏุงููุง ุนูู ุงูุฃุฎุฑู.

---

## ุงููุชุบูุฑุงุช ุงููุทููุจุฉ (GitHub Repository Variables)

ุงุฐูุจ ุฅูู **Settings โ Secrets and variables โ Actions โ Variables** ูุฃุถู:

| Variable | ูุซุงู | ุงููุตู |
|----------|------|-------|
| `REACT_APP_API_URL` | `https://your-server.onrender.com` | ุนููุงู ุงูุฎุงุฏู ุงูุฐู ูุชุตู ุจู ุงูุนููู |

> **ููุงุญุธุฉ:** `REACT_APP_API_URL` ูู **Variable** ูููุณ **Secret** ูุฃูู ูุธูุฑ ูู ุงูููุฏ ุงููุจูู.

---

## ุงููุดุฑ

### Server (ูุฑุน `server`)
- ูููุดุฑ ููุฏ ุงูุฎุงุฏู ููุง ูู (JavaScriptุ ุจุฏูู ุจูุงุก)
- ููุญุฐู: ุงุฎุชุจุงุฑุงุชุ devDependenciesุ ุณูุฑูุจุชุงุช ุงูุชุทููุฑ
- ููุถุงู `Procfile` ุชููุงุฆูุงู: `web: node index.js`
- ูุชูุงูู ูุน: **Render**, **Railway**, **Heroku**

### Web (ูุฑุน `web`)
- ููุจูู ุจู `react-scripts build`
- ูููุดุฑ ูุญุชูู `web/build/` ุฅูู ูุฑุน `web`
- ููุถุงู `.nojekyll` ูู GitHub Pages
- ูุชูุงูู ูุน: **GitHub Pages**, **Netlify**, **Vercel**

---

## ุฅุนุฏุงุฏ GitHub Pages

1. ุงุฐูุจ ุฅูู **Settings โ Pages**
2. ุงุฎุชุฑ **Source: Deploy from a branch**
3. ุงุฎุชุฑ ูุฑุน `web` ููุฌูุฏ `/ (root)`
4. ุงุญูุธ โ ุณูููุดุฑ ุงููููุน ุชููุงุฆูุงู

---

## ุงูุชุดุบูู ุงููุญูู

### Server
```bash
cd server
cp .env.example .env   # ุฃูุดุฆ ููู .env ุจุงููุชุบูุฑุงุช ุงููุทููุจุฉ
npm install
npm run dev
```

### Web
```bash
cd web
echo "REACT_APP_API_URL=http://localhost:5000" > .env.local
npm install
npm start
```

---

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฃุฎุทุงุก ุงูุฎุงุฏู (Server)

| ุงููุดููุฉ | ุงูุณุจุจ | ุงูุญู |
|---------|------|------|
| `cp: unrecognized option '--exclude'` | ุงุณุชุฎุฏุงู `cp` ุจุฏูุงู ูู `rsync` ูู Ubuntu | โ ุชู ุงูุฅุตูุงุญ: ูุณุชุฎุฏู `rsync` ุงูุขู |
| ูุดู ุงุฎุชุจุงุฑุงุช MongoDB | MongoDB service ูู ูุจุฏุฃ | ุชุญูู ูู GitHub Actions logs โ ูุฌุจ ุฃู ูุนุฑุถ `health-retries` |
| `node_modules` ูู ูุฑุน ุงูุชูุฒูุน | ูุณุฎ ุงููููุงุช ุจุฏูู ุงุณุชุซูุงุก | โ ุชู ุงูุฅุตูุงุญ: ุงุณุชุซูุงุก `.gitignore` ููุฏุฑุฌ ุงูุจูุงูุงุช |

### ุฃุฎุทุงุก ุงูููุจ (Web)

| ุงููุดููุฉ | ุงูุณุจุจ | ุงูุญู |
|---------|------|------|
| `Failed to load resource: 404` ูู GitHub Pages | ูููุงุช ุงูู build ูู ุชููุณุฎ | ุชุญูู ูู `๐ฆ Web deploy folder has X files` ูู logs |
| `yaml@2.8.2 from lock file` ุฃุซูุงุก npm ci | ุชุถุงุฑุจ ุงูุฅุตุฏุงุฑุงุช | โ ุชู ุงูุฅุตูุงุญ: ุฃุถููุง `yaml@^2.4.2` ุฅูู devDependencies |
| `Manifest fetch failed, code 404` | `.nojekyll` ูู ูููุณุฎ ุฃู ูุณุงุฑ github pages ุฎุงุทุฆ | ุชุฃูุฏ ูู: 1) `.nojekyll` ููุฌูุฏ 2) GitHub Pages ููุนุฏู ุนูู ูุฑุน `web` |
| ุจูุงุก ูุงุฑุบ (ุนุฏุฏ ุงููููุงุช ูููู ุฌุฏุงู) | `npm run build` ููุณูุฑ | ุชุญูู ูู ุฎุทุฃ ุงูุจูุงุก ูู CI logs โ ูุฏ ูููู `REACT_APP_API_URL` ูุงูุตุงู |

### ูุญูุตุงุช ุงูุชุดุฎูุต

ุนูุฏ ุญุฏูุซ ุฎุทุฃุ ุงุจุญุซ ุนู ุงูุจุทุงูุงุช ุงูุชุงููุฉ ูู CI logs:

```
๐ฆ Web deploy folder has X files          # ูุฌุจ ุฃู ูููู > 10 ูููุงุช
๐ค Copied X files to web branch           # ูุฌุจ ุฃู ูุณุงูู ุฑูู ุงูุฃูู ุชูุฑูุจุงู
โ Web build successful                   # ุฏูุงูุฉ ุงููุฌุงุญ
```

---

## ุงูุชุดุบูู ุงููุญูู

### Server
```bash
cd server
cp .env.example .env   # ุฃูุดุฆ ููู .env ุจุงููุชุบูุฑุงุช ุงููุทููุจุฉ
npm install
npm run dev
```

### Web
```bash
cd web
echo "REACT_APP_API_URL=http://localhost:5000" > .env.local
npm install
npm start
```

---

## ุงููุดุงูู ุงูุดุงุฆุนุฉ ูุงูุญููู

| ุงููุดููุฉ | ุงูุญู |
|---------|------|
| ูุดู ุงุฎุชุจุงุฑุงุช ุงูุฎุงุฏู | ุชุฃูุฏ ุฃู MongoDB service ูุนูู (ุชุญูู ูู ุงูู logs) |
| ูุดู ุจูุงุก ุงูููุจ | ุชุฃูุฏ ูู ุฅุถุงูุฉ `REACT_APP_API_URL` ูู Variables |
| ูู ูููุดุฑ ุดูุก | ุชุฃูุฏ ุฃู ุงูู push ุนูู ูุฑุน `main` ูููุณ ูุฑุน ุขุฎุฑ |
| `[skip ci]` ูู ุงูุฅูุฏุงุน | ุฅูุฏุงุนุงุช ุงููุดุฑ ุชุชุฌุงูู ุชุดุบูู ุงูู workflow ูุฑุฉ ุฃุฎุฑู |
